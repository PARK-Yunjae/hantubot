# ==============================================================================
# Hantubot 메인 설정 파일
# ==============================================================================

# [중요] 시스템 운영 모드
# 'mock': 모의투자. 실제 돈이 오가지 않으며, KIS 모의투자 서버를 사용합니다.
# 'live': 실전투자. 실제 돈으로 거래하며, KIS 실전투자 서버를 사용합니다.
# GUI가 시작될 때 이 값을 참조하며, 실행 중에는 변경할 수 없습니다.
mode: 'live'

# ------------------------------------------------------------------------------

# API 관련 설정
# 실제 키와 계좌번호는 보안을 위해 .env 파일에서 불러옵니다.
api:
  # .env 파일의 KIS_APP_KEY 값을 사용합니다.
  app_key: ${KIS_APP_KEY}
  # .env 파일의 KIS_APP_SECRET 값을 사용합니다.
  app_secret: ${KIS_APP_SECRET}
  # .env 파일의 KIS_ACCOUNT_NO 값을 사용합니다.
  account_no: ${KIS_ACCOUNT_NO}
  
  # 실전/모의투자 API Base URL (일반적으로 수정할 필요 없음)
  base_url:
    live: "https://openapi.koreainvestment.com:9443"
    mock: "https://openapivts.koreainvestment.com:29443"

# ------------------------------------------------------------------------------

# 종목 필터링 설정 (유목민 철학 적용)
stock_filter:
  # 최소 일 거래대금 (원). 유목민의 '150억/500억' 법칙 적용.
  # 150억 미만은 잡주로 간주하여 모든 전략에서 제외.
  min_trading_value_daily: 15000000000 
  # 최소 시가총액 (원). 1000억 미만 동전주/소형주 제외.
  min_market_cap: 100000000000
  # 제외할 섹터 및 키워드 (관리종목 등은 API에서 필터링)
  exclude_keywords: ['스팩', '리츠', 'ETN', 'ETF', '우선주', '홀딩스']

# 거래 시간 설정 (한국 시간 기준)
trading_hours:
  # 정규장 시작 시간 (이 시간부터 거래 로직 활성화)
  market_open: '09:00:00'
  # 정규장 종료 시간 (이 시간 이후 모든 주문 불가)
  market_close: '15:30:00'
  # 종가 매매 로직 준비 시간 (장 마감 동시호가 시작 시간)
  closing_call_start: '15:00:00' 

# ------------------------------------------------------------------------------

# 트레이딩 정책 설정
policy:
  # 포지션 우선순위 설정
  # 'closing_over_intraday': 14:50 이후 intraday 신규진입 금지, 14:48~14:50 강제청산으로 종가전략 기회 확보
  # 'intraday_over_closing': intraday 포지션이 있으면 종가전략 스킵
  position_priority: "closing_over_intraday"

# 전역 거래 설정
# 레짐(RISK_OFF)과 무관하게 강제로 매매를 활성화할지 여부
# 기본값은 false (안전 우선)
force_trade_enabled: false

# ------------------------------------------------------------------------------

# 트레이딩 루프 설정
# 메인 트레이딩 루프가 한 번의 사이클을 도는 주기 (초 단위)
# 30초: 강제 청산 정확도 향상 + 급등/급락 빠른 대응
trading_loop_interval_seconds: 30

# ------------------------------------------------------------------------------

# 활성화할 전략 목록
# hantubot/strategies/ 폴더 아래의 파이썬 파일명(확장자 제외)과 일치해야 합니다.
# 여기에 추가된 전략만 TradingEngine이 로드하여 실행합니다.
# 예:
# active_strategies:
#   - 'momentum_strategy'
#   - 'mean_reversion_strategy'
active_strategies:
  - 'closing_price_advanced_screener'
  - 'opening_breakout_strategy'
  - 'volume_spike_strategy'

# ------------------------------------------------------------------------------

# 알림 설정
notifications:
  discord:
    # Discord 알림 활성화 여부
    enabled: true
    # .env 파일의 DISCORD_WEBHOOK_URL 값을 사용합니다.
    webhook_url: ${DISCORD_WEBHOOK_URL}
  
  slack:
    # Slack 알림은 현재 구현되지 않았습니다.
    enabled: false
    token: ${SLACK_API_TOKEN}
    channel: '#trading-alerts'

# ------------------------------------------------------------------------------

# 로깅 설정
logging:
  # 로그 레벨: DEBUG, INFO, WARNING, ERROR, CRITICAL 중 선택
  # 'DEBUG': 가장 상세한 로그. 개발 시에만 사용 권장.
  # 'INFO': 일반적인 시스템 운영 상태 로그. 운영 시 권장.
  level: 'INFO' 
  
  # 로그 파일이 저장될 디렉토리 경로 (프로젝트 루트 기준)
  directory: 'logs'

# ------------------------------------------------------------------------------

# 레짐(시장 상황) 결정에 사용될 설정
regime_settings:
  # 이 값 이상이면 RISK_ON (상승장)으로 판단 (KOSPI 또는 KOSDAQ 등락률 %)
  risk_on_threshold: 0.7
  # 이 값 이하이면 RISK_OFF (하락장)으로 판단
  risk_off_threshold: -0.7

# ------------------------------------------------------------------------------

# 전략별 상세 설정
strategy_settings:
  closing_price_advanced_screener:
    # true로 설정하면, 스크리닝된 1위 종목을 자동으로 매수합니다.
    # false로 설정하면, Discord 알림만 보냅니다.
    auto_buy_enabled: true
    # 자동 매수 시 주문할 수량
    buy_quantity: 1
    # 지원하는 실행 모드 ('live': 실전, 'mock': 모의)
    supported_modes: ['mock', 'live']

  opening_breakout_strategy:
    # 1종목 고수 (복리 전략)
    max_positions: 1
    # 지원하는 실행 모드. 모의투자 시에는 네이버 금융 데이터로 대체하여 실행.
    supported_modes: ['mock', 'live']

  volume_spike_strategy:
    # 이 전략을 활성화할지 여부. false로 설정 시 레짐에 관계없이 실행되지 않음.
    enabled: true
    # 지원하는 실행 모드. 모의투자 시에는 네이버 금융 데이터로 대체하여 실행.
    supported_modes: ['mock', 'live']
    # 레짐별 파라미터. 현재 레짐에 해당하는 설정이 없으면 NEUTRAL 값을 기본으로 사용.
    params_by_regime:
      RISK_ON: # 상승장 (매매 기준 완화)
        name: "상승장 모드 (적극 매매)"
        take_profit_pct: 3.0
        stop_loss_pct: -2.0
        rank_jump_buy_threshold: 15 # 순위권 밖(>35)에 있던 종목이 이 순위 안으로 들어오면 매수
        rank_jump_prev_threshold: 35
        rank_sell_threshold: 40     # 보유 종목이 이 순위 밖으로 밀려나면 매도
        max_positions: 1            # [전수조사 수정] 1종목 복리 전략을 위해 1로 통일
        trade_enabled: true         # 이 레짐에서 거래 활성화
      NEUTRAL: # 횡보장 (기본 기준)
        name: "중립장 모드 (표준 매매)"
        take_profit_pct: 2.0
        stop_loss_pct: -2.0
        rank_jump_buy_threshold: 10 # 순위권 밖(>35)에 있던 종목이 이 순위 안으로 들어오면 매수
        rank_jump_prev_threshold: 30
        rank_sell_threshold: 30
        max_positions: 1
        trade_enabled: true
      RISK_OFF: # 하락장 (매매 기준 강화 또는 중단)
        name: "하락장 모드 (보수적 매매)"
        take_profit_pct: 1.5
        stop_loss_pct: -1.5
        rank_jump_buy_threshold: 5
        rank_jump_prev_threshold: 20
        rank_sell_threshold: 20
        max_positions: 1
        trade_enabled: false # 하락장에서는 신규 매수 안함
        
# ------------------------------------------------------------------------------

# ------------------------------------------------------------------------------

# 유목민 공부법 설정
study:
  # 저장 모드: sqlite (SQLite DB), gsheet (Google Sheets), both (둘 다)
  mode: 'sqlite'
  # 학습 메모 생성 활성화
  enable_study_notes: true
  # Git 자동 커밋 활성화
  enable_auto_commit: true
  # LLM 배치 크기 (한 번에 처리할 종목 수)
  llm_batch_size: 5
  # Gemini 모델 선택
  gemini_model: 'gemini-2.0-flash-exp'
  # DB 자동 백업 활성화 (일요일마다)
  enable_auto_backup: true
  # 백업 보관 기간 (일)
  backup_retention_days: 30

# 뉴스 수집 설정
news:
  # 종목당 최대 뉴스 수집 개수
  max_items_per_ticker: 20
  # Rate limit 대기 시간 (초)
  rate_limit_delay: 0.3

# ------------------------------------------------------------------------------

# 리스크 관리 설정 (실전 투자 전용 안전 장치)
risk_management:
  # 매수 시 사용할 현금 비중 (0.0 ~ 1.0)
  # 0.93: 미수 발생 방지 및 수수료/세금 고려한 안전 마진
  buy_cash_ratio: 0.93
  
  # 1회 주문 최대 금액 (원). 이 금액을 초과하는 주문은 거부됩니다.
  max_order_value_krw: 999999999 # 가용 현금 100% 사용을 위해 매우 큰 값으로 설정
  # 하루 동안의 누적 최대 매수 금액 (원). 이 금액을 초과하면 더 이상 매수 주문이 나가지 않습니다.
  max_daily_order_value_krw: 999999999 # 일일 제한 해제를 위해 매우 큰 값으로 설정
  # 하루 동안의 최대 실현 손실 금액 (원). 이 금액을 초과하면 모든 거래가 중단됩니다.
  max_daily_realized_loss_krw: 999999999 # 테스트를 위해 일일 손실 제한 해제
  # 긴급 정지 스위치. true로 설정 시 모든 주문이 거부됩니다.
  emergency_stop: false
  # 주문 처리 중 에러 발생 시 시스템을 즉시 중단할지 여부.
  halt_on_error: true
