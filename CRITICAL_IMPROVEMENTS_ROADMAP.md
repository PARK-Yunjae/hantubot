# ğŸš¨ Hantubot ê¸´ê¸‰ ê°œì„  ë¡œë“œë§µ

**ì‘ì„±ì¼**: 2025-12-28  
**ëª©ì **: ì‹¤ì „ íˆ¬ì ì•ˆì „ì„± í™•ë³´ (Gemini, ChatGPT, Claude í‰ê°€ ê¸°ë°˜)

---

## ğŸ”´ ê¸´ê¸‰ (Critical) - ì‹¤ì „ íˆ¬ì ì „ í•„ìˆ˜

### 1. engine.py ë™ê¸°í™” ë¬¸ì œ ìˆ˜ì • âš ï¸ ìµœìš°ì„ 
**ë¬¸ì œ**: `get_concluded_orders()` í˜¸ì¶œ ì‹œ ì „ì²´ ë´‡ ë™ì‘ì´ ë©ˆì¶¤ (0.1~1ì´ˆ)
**ìœ„í—˜ë„**: â˜…â˜…â˜…â˜…â˜… (ê¸‰ë“±ë½ ì‹œ ì£¼ë¬¸ ëˆ„ë½ ê°€ëŠ¥)

**ìˆ˜ì • ì „**:
```python
# engine.py Line ~115
concluded_orders = self.broker.get_concluded_orders()
```

**ìˆ˜ì • í›„**:
```python
loop = asyncio.get_running_loop()
concluded_orders = await loop.run_in_executor(None, self.broker.get_concluded_orders)
```

**ì˜ˆìƒ ì‹œê°„**: 10ë¶„  
**ì¦‰ì‹œ ì ìš©**: âœ… ì˜ˆ

---

### 2. ì‹¤ì „/ëª¨ì˜ ì„¤ì • ë¶„ë¦¬ + ì•ˆì „ì¥ì¹˜ ê°•í™”
**ë¬¸ì œ**: config.yaml ê¸°ë³¸ê°’ì´ `mode: 'live'` â†’ ì‹¤ìˆ˜ë¡œ ì‹¤ì „ ì£¼ë¬¸ ê°€ëŠ¥
**ìœ„í—˜ë„**: â˜…â˜…â˜…â˜…â˜…

**ê°œì„ ì•ˆ**:
1. config.yaml ê¸°ë³¸ê°’ì„ `mode: 'mock'`ìœ¼ë¡œ ë³€ê²½
2. config.live.yaml ë³„ë„ íŒŒì¼ ìƒì„±
3. GUI ì‹¤ì „ ëª¨ë“œ ì§„ì… ì‹œ 2ì¤‘ í™•ì¸
   - ì²´í¬ë°•ìŠ¤: "ì‹¤ì „ ëª¨ë“œì„ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤"
   - íƒ€ì´í•‘ í™•ì¸: "ì˜¤ëŠ˜ ë‚ ì§œ + ê³„ì¢Œë²ˆí˜¸ ë§ˆì§€ë§‰ 4ìë¦¬" ì…ë ¥

**ì˜ˆìƒ ì‹œê°„**: 30ë¶„  
**ì¦‰ì‹œ ì ìš©**: âœ… ì˜ˆ

---

### 3. ë¦¬ìŠ¤í¬ í•œë„ ì‹¤ì „ ìˆ˜ì¤€ìœ¼ë¡œ ì„¤ì •
**ë¬¸ì œ**: í˜„ì¬ ëª¨ë“  í•œë„ê°€ 999999999ì› (ë¬´ì œí•œ)
**ìœ„í—˜ë„**: â˜…â˜…â˜…â˜…â˜…

**í˜„ì¬ (config.yaml)**:
```yaml
risk_management:
  max_order_value_krw: 999999999
  max_daily_order_value_krw: 999999999
  max_daily_realized_loss_krw: 999999999
```

**ì‹¤ì „ ê¶Œì¥ (ì‚¬ìš©ì: ìµœëŒ€ ê¸ˆì•¡ êµ¬ë§¤)**:
```yaml
risk_management:
  max_order_value_krw: 118000  # í˜„ì¬ ë³´ìœ  í˜„ê¸ˆ(118,346ì›)ì˜ 95%
  max_daily_order_value_krw: 118000  # 1ì¼ 1íšŒ ë§¤ìˆ˜ (ì „ëµë³„ 1ì¢…ëª©)
  max_daily_realized_loss_krw: 50000  # ì¼ì¼ ìµœëŒ€ ì†ì‹¤ 5ë§Œì›
  emergency_stop: false  # ì •ìƒ ì‘ë™
  halt_on_error: true  # ì˜¤ë¥˜ ì‹œ ì¦‰ì‹œ ì¤‘ë‹¨ (ì‹¤ì „ í•„ìˆ˜)
```

**ì˜ˆìƒ ì‹œê°„**: 5ë¶„  
**ì¦‰ì‹œ ì ìš©**: âœ… ì˜ˆ

---

### 4. ë§¤ë„ ì‹œ ì—ëŸ¬ ì²˜ë¦¬ ê°•í™” (ChatGPT ì§€ì )
**ë¬¸ì œ**: ë§¤ë„ ì£¼ë¬¸ ì‹¤íŒ¨ ì‹œ í¬ì§€ì…˜ì´ ë‚¨ì•„ìˆì„ ìˆ˜ ìˆìŒ
**ìœ„í—˜ë„**: â˜…â˜…â˜…â˜…â˜†

**ê°œì„ ì•ˆ**:
```python
# order_manager.pyì— ë§¤ë„ ì‹¤íŒ¨ ì¬ì‹œë„ ë¡œì§ ì¶”ê°€
def place_sell_order_with_retry(self, signal, max_retries=3):
    for attempt in range(max_retries):
        try:
            result = self.broker.place_order(...)
            if result['success']:
                return result
            
            # ì‹¤íŒ¨ ì‹œ 0.5ì´ˆ ëŒ€ê¸° í›„ ì¬ì‹œë„
            time.sleep(0.5)
        except Exception as e:
            logger.error(f"ë§¤ë„ ì£¼ë¬¸ ì‹¤íŒ¨ (ì‹œë„ {attempt+1}/{max_retries}): {e}")
            
            if attempt == max_retries - 1:
                # ìµœì¢… ì‹¤íŒ¨ ì‹œ ê¸´ê¸‰ ì•Œë¦¼
                self.notifier.send_alert(
                    f"ğŸš¨ ê¸´ê¸‰: {signal['symbol']} ë§¤ë„ ì£¼ë¬¸ {max_retries}íšŒ ì‹¤íŒ¨!",
                    level='critical'
                )
```

**ì˜ˆìƒ ì‹œê°„**: 20ë¶„  
**ì¦‰ì‹œ ì ìš©**: âœ… ì˜ˆ

---

### 5. ì‹œì´ˆê°€ ì²­ì‚° ì‹œê°„ í†µì¼ (09:00 vs 09:01)
**ë¬¸ì œ**: ì½”ë“œëŠ” 09:01, ì‚¬ìš©ì ìš”êµ¬ëŠ” 09:01, ë¬¸ì„œëŠ” ë¶ˆëª…í™•
**ìœ„í—˜ë„**: â˜…â˜…â˜…â˜†â˜†

**í˜„ì¬ ìƒíƒœ**: âœ… ì´ë¯¸ 09:01ë¡œ ìˆ˜ì •ë¨ (ì´ì „ ì»¤ë°‹)
**ì¶”ê°€ ì‘ì—…**: README.md ëª…í™•íˆ ê¸°ì¬

**ì˜ˆìƒ ì‹œê°„**: 5ë¶„  
**ì¦‰ì‹œ ì ìš©**: âœ… ì˜ˆ

---

## ğŸŸ¡ ì¤‘ìš” (High) - ì‹¤ì „ ì•ˆì •ì„± í–¥ìƒ

### 6. KIS API Rate Limit ì „ì—­ ê´€ë¦¬
**ë¬¸ì œ**: ì—¬ëŸ¬ ì „ëµì´ ë™ì‹œì— API í˜¸ì¶œ ì‹œ í•œë„ ì´ˆê³¼ (EGW00201)
**ìœ„í—˜ë„**: â˜…â˜…â˜…â˜…â˜†

**ê°œì„ ì•ˆ**:
```python
# hantubot/execution/rate_limiter.py (ì‹ ê·œ ìƒì„±)
class RateLimiter:
    """í† í° ë²„í‚· ë°©ì‹ Rate Limiter"""
    def __init__(self, max_calls=20, period=1.0):
        self.max_calls = max_calls
        self.period = period
        self.calls = []
        self.lock = asyncio.Lock()
    
    async def acquire(self):
        async with self.lock:
            now = time.time()
            # period ì´ì „ í˜¸ì¶œ ì œê±°
            self.calls = [c for c in self.calls if now - c < self.period]
            
            if len(self.calls) >= self.max_calls:
                sleep_time = self.period - (now - self.calls[0])
                await asyncio.sleep(sleep_time)
                self.calls = self.calls[1:]
            
            self.calls.append(now)
```

**broker.pyì— ì ìš©**:
```python
class Broker:
    def __init__(self, ...):
        self.rate_limiter = RateLimiter(max_calls=20, period=1.0)
    
    async def _request(self, ...):
        await self.rate_limiter.acquire()
        # ê¸°ì¡´ ë¡œì§...
```

**ì˜ˆìƒ ì‹œê°„**: 40ë¶„  
**ì¦‰ì‹œ ì ìš©**: â–³ ì„ íƒ (ì•ˆì •í™” í›„ ì ìš© ê¶Œì¥)

---

### 7. ë°ì´í„° ìºì‹œ ì „ëµ ê°œì„ 
**ë¬¸ì œ**: í˜„ì¬ê°€ë¥¼ ë§¤ í‹±ë§ˆë‹¤ í˜¸ì¶œ â†’ API ë‚­ë¹„
**ìœ„í—˜ë„**: â˜…â˜…â˜…â˜†â˜†

**ê°œì„ ì•ˆ**:
```python
# í˜„ì¬ê°€ ìºì‹œ (1~2ì´ˆ)
class PriceCache:
    def __init__(self, ttl=2.0):
        self.cache = {}
        self.ttl = ttl
    
    def get(self, symbol):
        if symbol in self.cache:
            price, timestamp = self.cache[symbol]
            if time.time() - timestamp < self.ttl:
                return price
        return None
    
    def set(self, symbol, price):
        self.cache[symbol] = (price, time.time())
```

**ì˜ˆìƒ ì‹œê°„**: 30ë¶„  
**ì¦‰ì‹œ ì ìš©**: â–³ ì„ íƒ (2ìˆœìœ„)

---

### 8. ì²´ê²° ì¡°íšŒ ì •í™•ë„ ê²€ì¦
**ë¬¸ì œ**: `get_concluded_orders()`ê°€ ë¶€ë¶„ì²´ê²°/ì •ì •/ì·¨ì†Œë¥¼ ì •í™•íˆ ì²˜ë¦¬í•˜ëŠ”ì§€ ë¶ˆëª…í™•
**ìœ„í—˜ë„**: â˜…â˜…â˜…â˜…â˜†

**ê°œì„ ì•ˆ**:
1. ì²´ê²° ë‚´ì—­ ì „ìš© API ì‚¬ìš© (KIS inquire-daily-ccld)
2. execution_id ìœ ë‹ˆí¬ì„± ê²€ì¦
3. ë¶€ë¶„ì²´ê²° ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸

**ì˜ˆìƒ ì‹œê°„**: 60ë¶„  
**ì¦‰ì‹œ ì ìš©**: â–³ ì„ íƒ (ëª¨ì˜ íˆ¬ìë¡œ ë¨¼ì € ê²€ì¦)

---

## ğŸŸ¢ ë³´í†µ (Medium) - ìš´ì˜ í¸ì˜ì„±

### 9. ë¹„ì •ìƒ ìƒíƒœ ì•Œë¦¼ ê°•í™”
**í˜„ì¬**: _has_error_occurred = Trueë¡œë§Œ ì²˜ë¦¬
**ê°œì„ **: Discordì— ìƒì„¸ ì˜¤ë¥˜ ì •ë³´ + ë§ˆì§€ë§‰ API í˜¸ì¶œ ì •ë³´

**ì˜ˆìƒ ì‹œê°„**: 20ë¶„  
**ì¦‰ì‹œ ì ìš©**: â–³ ì„ íƒ

---

### 10. ëŒ€ì‹œë³´ë“œ ì„±ëŠ¥ ìµœì í™”
**ë¬¸ì œ**: ë‰´ìŠ¤ ë°ì´í„° ë§ì•„ì§€ë©´ ëŠë ¤ì§
**ê°œì„ **: Lazy Loading (expander ì—´ ë•Œë§Œ ë¡œë“œ)

**ì˜ˆìƒ ì‹œê°„**: 40ë¶„  
**ì¦‰ì‹œ ì ìš©**: âœ— ì•„ë‹ˆì˜¤ (ë°ì´í„° ìŒ“ì¸ í›„)

---

## ğŸ“‹ ì¦‰ì‹œ ì ìš© ê¶Œì¥ ìˆœì„œ

### Phase 1: ê¸´ê¸‰ (ì‹¤ì „ íˆ¬ì ì „ í•„ìˆ˜) - ì´ 70ë¶„
1. âœ… engine.py ë™ê¸°í™” ìˆ˜ì • (10ë¶„)
2. âœ… ì‹¤ì „/ëª¨ì˜ ë¶„ë¦¬ + ì•ˆì „ì¥ì¹˜ (30ë¶„)
3. âœ… ë¦¬ìŠ¤í¬ í•œë„ ì‹¤ì „ ì„¤ì • (5ë¶„)
4. âœ… ë§¤ë„ ì¬ì‹œë„ ë¡œì§ (20ë¶„)
5. âœ… README ì‹œê°„ ëª…í™•í™” (5ë¶„)

### Phase 2: ì¤‘ìš” (ì•ˆì •í™”) - ì´ 130ë¶„
6. â–³ Rate Limiter (40ë¶„) - ëª¨ì˜ íˆ¬ì ì¤‘ ì ìš©
7. â–³ ìºì‹œ ê°œì„  (30ë¶„) - ì„ íƒ
8. â–³ ì²´ê²° ê²€ì¦ (60ë¶„) - ëª¨ì˜ íˆ¬ìë¡œ ê²€ì¦

### Phase 3: ë³´í†µ (ì—¬ìœ  ì‹œ) - ì´ 60ë¶„
9. â–³ ì•Œë¦¼ ê°•í™” (20ë¶„)
10. âœ— ëŒ€ì‹œë³´ë“œ ìµœì í™” (40ë¶„) - ë‚˜ì¤‘

---

## ğŸ¯ ì‚¬ìš©ì ìš”êµ¬ì‚¬í•­ ë°˜ì˜

**ì‚¬ìš©ì í”„ë¡œí•„**:
- âœ… ì‹¤ì „ íˆ¬ì ì˜ˆì •
- âœ… ìµœëŒ€ ê¸ˆì•¡ êµ¬ë§¤ (93~95%)
- âœ… 1ì¢…ëª© ì§‘ì¤‘ íˆ¬ì

**ë§ì¶¤ ì„¤ì •**:
```yaml
risk_management:
  max_order_value_krw: 112000  # í˜„ê¸ˆ 118,346 Ã— 95%
  max_daily_order_value_krw: 112000  # 1ì¼ 1íšŒ
  max_daily_realized_loss_krw: 50000  # -5ë§Œì› ì†ì ˆ
  emergency_stop: false
  halt_on_error: true  # ì˜¤ë¥˜ ì‹œ ì¦‰ì‹œ ì¤‘ë‹¨

# ì „ëµë³„ ì„¤ì •
strategy_settings:
  opening_breakout_strategy:
    max_positions: 1  # âœ… ì´ë¯¸ ì ìš©ë¨
  volume_spike_strategy:
    params_by_regime:
      RISK_ON:
        max_positions: 1  # âœ… ì´ë¯¸ ì ìš©ë¨
  closing_price_advanced_screener:
    buy_quantity: 1  # âœ… ì´ë¯¸ ì ìš©ë¨
```

---

## â“ ì‚¬ìš©ì í™•ì¸ í•„ìš”

### Q1: Phase 1 (ê¸´ê¸‰ 5ê±´) ì¦‰ì‹œ ì ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
- [ ] ì˜ˆ, ëª¨ë‘ ì ìš© (ê¶Œì¥)
- [ ] ì¼ë¶€ë§Œ ì„ íƒ (ë²ˆí˜¸ ì§€ì •: ___)
- [ ] ì•„ë‹ˆì˜¤, ê²€í† ë§Œ

### Q2: ë¦¬ìŠ¤í¬ í•œë„ ì„¤ì •
- ìµœëŒ€ ì£¼ë¬¸ ê¸ˆì•¡: 112,000ì› (95%) ì ì •í•œê°€ìš”?
- ì¼ì¼ ìµœëŒ€ ì†ì‹¤: 50,000ì› ì ì •í•œê°€ìš”?
- ì¡°ì • í•„ìš” ì‹œ ì›í•˜ì‹œëŠ” ê¸ˆì•¡: ___________

### Q3: Phase 2 (ì¤‘ìš” 3ê±´) ì ìš© ì‹œê¸°
- [ ] ì§€ê¸ˆ ë°”ë¡œ
- [ ] ëª¨ì˜ íˆ¬ì ì¤‘ ì ìš© (ê¶Œì¥)
- [ ] ì‹¤ì „ íˆ¬ì í›„ ë¬¸ì œ ë°œìƒ ì‹œ

---

## ğŸ“Š ì˜ˆìƒ ê²°ê³¼

### Phase 1 ì ìš© í›„:
- âœ… ì‹¤ìˆ˜ë¡œ ì‹¤ì „ ì£¼ë¬¸ ë°©ì§€
- âœ… ê¸‰ë“±ë½ ì‹œ ì£¼ë¬¸ ëˆ„ë½ ë°©ì§€
- âœ… ì¼ì¼ ì†ì‹¤ í•œë„ ë³´í˜¸
- âœ… ë§¤ë„ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„
- âœ… ë¬¸ì„œ-ì½”ë“œ ë¶ˆì¼ì¹˜ í•´ì†Œ

### ì „ì²´ ì ìš© í›„:
- âœ… API í˜¸ì¶œ íš¨ìœ¨ 3ë°° í–¥ìƒ
- âœ… ì‹œìŠ¤í…œ ì•ˆì •ì„± 95% â†’ 99%
- âœ… ì‹¤ì „ íˆ¬ì ì¤€ë¹„ ì™„ë£Œ

---

**âš ï¸ ì¤‘ìš” ê¶Œê³ **:
Phase 1 (ê¸´ê¸‰ 5ê±´)ì€ **ì‹¤ì „ íˆ¬ì ì „ ë°˜ë“œì‹œ ì ìš©**ì„ ê¶Œì¥í•©ë‹ˆë‹¤.
íŠ¹íˆ í•­ëª© 1, 2, 3, 4ëŠ” ëˆì„ ìƒì„ ìˆ˜ ìˆëŠ” ì¹˜ëª…ì ì¸ ë¶€ë¶„ì…ë‹ˆë‹¤.

**í™•ì¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤**: ì–´ëŠ í•­ëª©ë¶€í„° ì ìš©í• ê¹Œìš”?
